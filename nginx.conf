# nginx.conf
# This configuration is designed to be as minimal as possible for inclusion
# into the main Nginx configuration by the Docker base image, avoiding
# directives that might conflict with global settings.

server {
    listen 80; # Nginx listens on port 80 for incoming HTTP requests
    server_name localhost; # Domain name for this server block

    # Root directory for your static files (where the React build is copied)
    root /usr/share/nginx/html;

    # Default files to serve if a directory is requested
    index index.html index.htm;

    # Location block for all requests
    location / {
        # Try to serve the requested file ($uri), or the directory index ($uri/),
        # or fall back to /index.html (essential for React's client-side routing).
        try_files $uri $uri/ /index.html;
    }

    # Crucial Fix: Specify writable paths for temporary files and cache
    # These paths are within /var/tmp which is typically writable by the Nginx user.
    client_body_temp_path /var/tmp/nginx_client_temp;
    proxy_temp_path       /var/tmp/nginx_proxy_temp;
    fastcgi_temp_path     /var/tmp/nginx_fastcgi_temp;
    uwsgi_temp_path       /var/tmp/nginx_uwsgi_temp;
    scgi_temp_path        /var/tmp/scgi_temp; # Added scgi_temp, just in case

    # Custom error page for 5xx errors (e.g., 500, 502, 503, 504)
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}